# CallAnnotate

Полнофункциональное решение для автоматической аннотации телефонных разговоров в контейнере Docker под Gentoo Linux (amd64). CallAnnotate предоставляет разработм и системным администраторам гибкий серверный компонент с WebSocket и REST/JSON API, способный асинхронно обрабатывать аудиозаписи любой длительности и сложности, используя ресурсы CPU или при необходимости GPU.

<!-- Badges -->
[![CI Status](https://github.com/momentics/CallAnnotate/actions/workflows/ci.yml/badge.svg)](https://github.com/moment/CallAnnotate/actions/workflows/ci.yml)   [![License](https://img.shields.io/badge/license-Apache%202.0-blue.svg)](LICENSE)

[![Latest Release](https://img.shields.io/github/v/release/momentics/CallAnnotate?style=for-the-badge)](https://github.com/momentics/CallAnnotate/releases)   [![Last Commit](https://img.shields.io/github/last-commit/momentics/CallAnnotate?style=for-the-badge)](https://github.com/momentics/CallAnnotate/commits/main)  


## Основные возможности

1. **Docker-образ на базе Alpine Linux (amd64)**
CallAnnotate создаёт лёгкий и безопасный контейнер, готовый к развёртыванию на любых серверах и облачных платформах, поддерживающих Docker. 
2. **Универсальные интерфейсы API**
    - **WebSocket** позволяет устанавливать постоянное соединение для потоковой передачи аудио и мгновенного получения результатов.
    - **REST/JSON** интерфейс предназначен для пакетной обработки задач: отправьте запрос с файлом, получите полную аннотацию в ответе.
3. **Асинхронная архитектура обработки**
Все задачи помещаются в очередь и обрабатываются асинхронно, что исключает блокировку сервера. CallAnnotate может распределять нагрузку между ядрами CPU и, при наличии поддерживаемого оборудования, GPU-ускорителем.
4. **Диаризация говорящих**
Алгоритмы выделения сегментов аудио автоматически распознают смены говорящих, разделяют файл на спикер-ориентированные блоки и сохраняют таймкоды каждого участка.
5. **Распознавание известных голосов**
Согласно конфигурации контейнера, CallAnnotate загружает заранее сформированные голосовые эмбеддинги и сопоставляет их с поступающими фрагментами. Это позволяет автоматически отмечать в аннотации имена участников, чьи голоса уже известны системе.
6. **Идентификация новых записей через CardDAV**
При встрече незнакомого голоса CallAnnotate выполняет запросы к CardDAV-серверу, чтобы найти совпадения по контактам пользователя. Если совпадений не обнаружено, система аккуратно помечает фрагмент как «неизвестный спикер».
7. **Транскрипция с многослойной разметкой**
Используя современные движки ASR, CallAnnotate переводит аудио в текст и структурирует результат по уровням (схоже с системой ELAN):
    - отдельное слово и его начало/конец
    - предложения и абзацы
    - метки спикеров
8. **Готовая аннотация в одном JSON**
По окончании обработки API возвращает полный объём метаданных:
    - сегментация по спикерам и таймкоды
    - идентификаторы и имена найденных голосов
    - ссылки на источники эмбеддингов
    - транскрипция с выделением уровней
    - при необходимости — URL для скачивания аудиофрагментов

## Зачем использовать CallAnnotate?

- **Автоматизация рабочих процессов**
Идеально подходит для систем мониторинга колл-центров, записи интервью или любых задач анализа телефонных разговоров.
- **Гибкая интеграция**
Унифицированные WebSocket и REST/JSON интерфейсы позволяют легко встраивать CallAnnotate в существующие сервисы и пайплайны обработки данных.
- **Расширяемая архитектура**
Модульный дизайн и конфигурация через YAML дают возможность быстро добавлять новые алгоритмы диаризации, ASR-модели или методы идентификации.
- **Надёжность и масштабируемость**
Асинхронная очередь задач и поддержка контейнеризации гарантируют стабильную работу в высоконагруженных средах.


## Быстрый старт

1. Клонируйте репозиторий:

```bash
git clone https://github.com/momentics/CallAnnotate.git
cd CallAnnotate
```

2. Соберите Docker-образ:

```bash
docker build -t callannotate:latest -f docker/Dockerfile .
```

3. Запустите контейнер:

```bash
docker run -d \
  --name callannotate \
  -v $(pwd)/config/default.yaml:/app/config.yaml \
  -p 8000:8000 \
  callannotate:latest
```

4. Используйте API:
    - WebSocket: `ws://<host>:8000/ws`
    - REST/JSON: `POST http://<host>:8000/api/annotate`

## Конфигурация

Файл `config/default.yaml` позволяет тонко настраивать работу сервера:

```yaml
server:
  host: 0.0.0.0
  port: 8000

carddav:
  url: "https://carddav.example.com"
  user: "username"
  password: "password"

voices:
  - name: "Иван"
    embedding: "/app/embeddings/ivan.vec"
  - name: "Мария"
    embedding: "/app/embeddings/maria.vec"
```


## Лицензия

Проект распространяется под лицензией Apache License 2.0. Подробности — в файлах `LICENSE` и `NOTICE`.

Готовый к промышленному внедрению и активному развитию, CallAnnotate открывает новые возможности для автоматизированного анализа и аннотирования аудио. Присоединяйтесь к сообществу, вносите вклад и улучшайте качество распознавания разговоров вместе с нами!
